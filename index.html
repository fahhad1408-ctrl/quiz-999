<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg,#0a0a0a,#1f1f1f);
      text-align: center;
      margin: 0;
      padding: 20px;
      color: #f5f5f5;
    }
    .hidden { display:none; }
    .screen {
      max-width: 600px;
      margin: auto;
      background: rgba(30,30,30,0.85);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.05);
    }
    h2 { font-size:26px; margin-bottom:10px; }
    p { font-size:16px; margin-bottom:20px; }
    input[type="text"] {
      padding:12px;
      width:90%;
      margin:10px 0;
      border-radius:12px;
      border:1px solid #555;
      background: rgba(255,255,255,0.05);
      color:#f5f5f5;
    }
    input::placeholder { color:#ccc; }
    img {
      max-width:100%;
      border-radius:12px;
      margin:15px 0;
      border:1px solid #444;
    }
    button {
      padding:14px 24px;
      margin:10px 5px;
      cursor:pointer;
      font-weight:600;
      font-size:16px;
      border-radius:12px;
      border:none;
      transition: all 0.3s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }
    #activateBtn, #nextBtn { background: linear-gradient(90deg,#d4af37,#f0d47a); color:#111; }
    #storeBtn { background: linear-gradient(90deg,#6b21a8,#a78bfa); color:#fff; }
    #choices button { background: linear-gradient(90deg,#1e3a8a,#3b82f6); color:#fff; width:90%; }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(255,255,255,0.3), 0 0 50px rgba(255,255,255,0.15);
    }
  </style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
<div id="startScreen" class="screen">
  <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ğŸ‘‹</h2>
  <p>Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</p>
  <input type="text" id="userCode" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§">
  <button id="activateBtn">ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</button>
  <p id="activationMsg"></p>
  <button id="storeBtn">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
<div id="quizScreen" class="screen hidden">
  <img id="questionImage" src="" alt="Ø§Ù„Ø³Ø¤Ø§Ù„">
  <div id="choices"></div>
  <p id="feedback"></p>
  <button id="nextBtn" class="hidden">Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
<div id="resultScreen" class="screen hidden">
  <h2>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ğŸ¯</h2>
  <p id="finalScore"></p>
  <p id="weakPoints"></p>
  <button onclick="restart()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<script>
const repoRawUrl = "https://raw.githubusercontent.com/fahhad1408-ctrl/quiz-999/main/";
const codesFile = "Ù‚Ø§Ù„Ø¨_Ø§Ù„Ø£ÙƒÙˆØ§Ø¯.XLSX";
const questionsFile = "questions.xlsx";

let codesData = [];
let questions = [];
let currentQuestion = 0;
let score = 0;
let weakSections = [];

function fetchExcelAndRead(fileName, callback) {
  fetch(repoRawUrl + fileName)
    .then(res => res.arrayBuffer())
    .then(data => {
      const workbook = XLSX.read(data, {type:'array'});
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet, {header:1});
      callback(json);
    }).catch(e => { alert("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: " + fileName); console.error(e); });
}

window.addEventListener("load", () => {
  fetchExcelAndRead(codesFile, data => {
    codesData = data.slice(1).map(r => ({code: (r[0]||"").toString().trim()}));
    fetchExcelAndRead(questionsFile, qdata => {
      questions = qdata.slice(1).map(r => ({
        image: r[0],
        choices: (r[1]||"").split("ØŒ"),
        correct: r[2],
        explain: r[3],
        section: r[4]
      }));
    });
  });
});

document.getElementById("activateBtn").addEventListener("click", () => {
  const code = document.getElementById("userCode").value.trim();
  const msg = document.getElementById("activationMsg");
  if (!code) { msg.textContent="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯."; msg.style.color="red"; return; }
  const found = codesData.find(c => c.code.toLowerCase() === code.toLowerCase());
  if (found) {
    msg.textContent="âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!"; msg.style.color="green";
    setTimeout(()=>{
      document.getElementById("startScreen").classList.add("hidden");
      document.getElementById("quizScreen").classList.remove("hidden");
      startQuiz();
    },1000);
  } else { msg.textContent="âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­. Ø­Ø§ÙˆÙ„ Ø¨ÙƒÙˆØ¯ Ø¢Ø®Ø±."; msg.style.color="red"; }
});

document.getElementById("storeBtn").addEventListener("click",()=>window.open("https://www.madty.net/fd1/","_blank"));

function startQuiz() { currentQuestion=0; score=0; weakSections=[]; showQuestion(); }

function showQuestion() {
  const q = questions[currentQuestion];
  document.getElementById("questionImage").src=q.image;
  const cDiv=document.getElementById("choices");
  cDiv.innerHTML="";
  q.choices.forEach(ch=>{
    const btn=document.createElement("button");
    btn.textContent=ch.trim();
    btn.onclick=()=>checkAnswer(ch.trim());
    cDiv.appendChild(btn);
  });
  document.getElementById("feedback").textContent="";
  document.getElementById("nextBtn").classList.add("hidden");
}

function checkAnswer(choice){
  const q=questions[currentQuestion];
  const feedback=document.getElementById("feedback");
  const correctChoice=(q.correct||"").trim();
  if(choice.startsWith(correctChoice)){ score++; feedback.innerHTML="âœ… Ø¥Ø¬Ø§Ø¨ØªÙƒ ØµØ­ÙŠØ­Ø©!"; }
  else { feedback.innerHTML=`âŒ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø®Ø§Ø·Ø¦Ø©. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${correctChoice}`; if(q.section) weakSections.push(q.section); }
  if(q.explain){ const img=document.createElement("img"); img.src=q.explain; feedback.appendChild(img); }
  document.getElementById("nextBtn").classList.remove("hidden");
}

document.getElementById("nextBtn").addEventListener("click",()=>{
  currentQuestion++;
  if(currentQuestion<questions.length) showQuestion();
  else showResult();
});

function showResult(){
  document.getElementById("quizScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  const percent=Math.round((score/questions.length)*100);
  document.getElementById("finalScore").textContent=`Ù†ØªÙŠØ¬ØªÙƒ: ${percent} Ù…Ù† 100`;
  const unique=[...new Set(weakSections)];
  document.getElementById("weakPoints").textContent=unique.length? "Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù: "+unique.join("ØŒ "):"Ù…Ù…ØªØ§Ø²! Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù.";
}

function restart(){
  document.getElementById("resultScreen").classList.add("hidden");
  document.getElementById("startScreen").classList.remove("hidden");
}
</script>
</body>
</html>
